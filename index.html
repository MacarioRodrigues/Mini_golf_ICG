<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Golf 3D</title>
    <style>
       body { 
            margin: 0;
            overflow: hidden;
       }
    </style>
</head>
<body>

    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>

	<script type="importmap">
		{
    		"imports": {
     			"three": "https://unpkg.com/three@0.150.1/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.150.1/examples/jsm/"
            }
  		}
	</script>
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        // Inicialização da cena
        //let ballVelocity = new THREE.Vector3();
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);


        // Controles de órbita
        const controls = new OrbitControls(camera, renderer.domElement);


        const golfmodelurl = '/Mini_golf_ICG/assets/golf_ball/scene.gltf';

        let golfballmodel;
        let ball;
        let isMouseDown = false;
        let mouseDownTime = 0;
        let mouseUpTime = 0;

        const loader_golf = new GLTFLoader();
        loader_golf.load(golfmodelurl, function (gltf) {
            golfballmodel = gltf.scene;
            golfballmodel.scale.set(0.03, 0.03, 0.03);
            golfballmodel.position.set(2.8,-1,0);           // Não alterar
            const golfballmodelClone = golfballmodel.clone();
            const ballGeometry = new THREE.SphereGeometry(1, 32, 32);
            const ballMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff });
            const ball = new THREE.Mesh(ballGeometry, ballMaterial);
            ball.position.set(-30, 1, -30);
            ball.add(golfballmodelClone);
            scene.add(ball);
        }, undefined, function (error) {
            console.error(error);
        });

        const helper_axes = new THREE.AxesHelper(1000);
        scene.add(helper_axes);
        
        // Campo de golfe
        const groundGeometry = new THREE.PlaneGeometry(100, 100);
        const groundTexture = new THREE.TextureLoader().load("/Mini_golf_ICG/assets/img/TCom_GrassCheckered_header.jpg");
        const groundMaterial = new THREE.MeshBasicMaterial({ map: groundTexture, side: THREE.DoubleSide });
        const ground = new THREE.Mesh(groundGeometry, groundMaterial);
        ground.rotation.x = -Math.PI / 2;
        scene.add(ground);

        const holeGeometry = new THREE.CylinderGeometry(2, 2, 1, 32);
        const holeMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });
        const hole = new THREE.Mesh(holeGeometry, holeMaterial);
        hole.position.set(30, -0.4, 30); 
        scene.add(hole);

        const flagmodelurl = '/Mini_golf_ICG/assets/golf_flag/scene.gltf';

        let flagmodel;
        let flag;

        const loader_flag = new GLTFLoader();
        // Carregue o modelo glTF
        loader_flag.load(flagmodelurl, function (gltf) {
            // Crie uma variável para armazenar o modelo
            flagmodel = gltf.scene;
            flagmodel.scale.set(1, 1, 1);
            flagmodel.position.set(0,10,0);           // Não alterar
            const flagmodelClone = flagmodel.clone();
            const flagGeometry = new THREE.PlaneGeometry(1, 15);
            const flagMaterial = new THREE.MeshStandardMaterial({ color: 0x000000 }); 
            const flag = new THREE.Mesh(flagGeometry, flagMaterial);
            flag.position.set(33, 5, 33); 
            scene.add(flag);
            flag.add(flagmodelClone);
            scene.add(flag);
        }, undefined, function (error) {
            console.error(error);
        });

        const wallGeometry = new THREE.BoxGeometry(100, 5, 5); 
        const wallTexture = new THREE.TextureLoader().load("/Mini_golf_ICG/assets/img/TCom_Wood_ThermallyModifiedAsh_header.jpg")
        const wallMaterial = new THREE.MeshStandardMaterial({ map:wallTexture }); 
        const wall = new THREE.Mesh(wallGeometry, wallMaterial);
        wall.position.set(0, 2.5, 50); 
        scene.add(wall);

        const wall_2 = new THREE.Mesh(wallGeometry, wallMaterial);
        wall_2.position.set(0, 2.5, -50); 
        scene.add(wall_2);

        const wallGeometry_3 = new THREE.BoxGeometry(105, 5, 5); 
        const wall_3 = new THREE.Mesh(wallGeometry_3,wallMaterial);
        wall_3.rotation.y = -Math.PI / 2;
        wall_3.position.set(50, 2.5, 0); 
        scene.add(wall_3);

        const wall_4 = new THREE.Mesh(wallGeometry_3, wallMaterial);
        wall_4.rotation.y = -Math.PI / 2;
        wall_4.position.set(-50, 2.5, 0); 
        scene.add(wall_4);

        // // Crie uma linha indicativa
        // const lineGeometry = new THREE.BufferGeometry().setFromPoints([new THREE.Vector3(), new THREE.Vector3()]);
        // const lineMaterial = new THREE.LineBasicMaterial({ color: 0xff0000 });
        // line = new THREE.Line(lineGeometry, lineMaterial);
        // scene.add(line);

        //document.addEventListener('mousedown', onMouseDown);
        //document.addEventListener('mouseup', onMouseUp);
        //document.addEventListener('mousemove', onMouseMove);

            // Adicionar obstáculos
            //const obstacles = [
        //    { x: 0, z: 20, width: 5, depth: 5 },
        //    { x: 15, z: 30, width: 8, depth: 3 },
        //    { x: -10, z: 40, width: 4, depth: 6 }
        //];

        //obstacles.forEach(obstacle => {
        //    const obstacleGeometry = new THREE.BoxGeometry(obstacle.width, 2, obstacle.depth);
        //    const obstacleMaterial = new THREE.MeshBasicMaterial({ color: 0x8B4513 });
        //    const obstacleMesh = new THREE.Mesh(obstacleGeometry, obstacleMaterial);
        //    obstacleMesh.position.set(obstacle.x, 1, obstacle.z);
        //    scene.add(obstacleMesh);
        //});

        

        // Controle de câmera
        camera.position.set(-50, 30, -52);
        camera.lookAt(-30, 1, -30);

        const light_2 = new THREE.AmbientLight( 0x404040 ); 
        scene.add( light_2 );

        const directionalLight = new THREE.DirectionalLight( 0xffffff, 0.5 );
        directionalLight.position.set(-50,30,0);
        scene.add( directionalLight );  

        // Crie uma luz direcional
        const directionalLight_2 = new THREE.DirectionalLight(0xffffff, 0.5);
        directionalLight_2.position.set(55,30,40)
        scene.add(directionalLight_2);
        
        const pointLight = new THREE.PointLight(0xffffff, 0.5); 
        pointLight.position.set(-10, 10, 10); 
        scene.add(pointLight);
        
        const pointLight_2 = new THREE.PointLight(0xffffff, 0.5); 
        pointLight.position.set(-10, 5, -10); 
        scene.add(pointLight);

        // Adicionar luz
        const light = new THREE.PointLight(0xffffff, 1, 100);
        light.position.set(0, 50, -50);
        scene.add(light);

        
        const helper = new THREE.DirectionalLightHelper( directionalLight, 5 );
        const helper_2 = new THREE.DirectionalLightHelper( directionalLight_2, 5 );
        scene.add(helper);
        scene.add( helper_2 );
        //renderer.setClearColor(0xFFFFFF);

        // Função para verificar se a bola entrou no buraco
        function checkHole(ball, hole) {
            const distance = ball.position.distanceTo(hole.position);
            if (distance < 1) { 
                hole.material.color.set(0xFF0000); // Vermelho
            }
        }

        // Controle de atualização da cena
        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        animate();
    </script>
</body>
</html>